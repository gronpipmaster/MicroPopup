(function(e){var t={init:function(n){var r=this;r.settings=e.extend({callback:function(){},debug:false},n);if(r.settings.debug)console.log("Start trace:");t.data=e(this);t.settings=r.settings;if(e(".micropopup-overlay").length===0)e("body").append('<div class="micropopup-overlay" />');if(e(".micropopup-container").length===0)e("body").append('<div class="micropopup-container"><div class="inner"></div><div class="controls"></div><div class="close"></div></div>');if(e(".micropopup-loader").length===0)e("body").append('<div class="micropopup-loader" />');t.overlay=e(".micropopup-overlay");t.container=e(".micropopup-container");t.loader=e(".micropopup-loader");r.settings.image=t.data.find("img").length>0?true:false;if(!r.settings.image){t.data.unbind("click").bind("click",function(){var n=this.href;e.get(n,function(e){t.settings.image=false;t.open(e,n);if(r.settings.callback!="function (){}")r.settings.callback()});return false})}else{t.sliding()}},open:function(n,r){var i=e.Deferred();t.openLoader();t.container.find(".inner").html(n);t.container.attr("style","");var s=function(){i.done(function(){t.position()}).done(function(){t.closeLoader();t.overlay.show();t.container.fadeIn(200);t.debug("container show")})};if(t.settings.image){t.container.find(".inner").removeClass("html");t.container.find(".controls").show();t.slidingBind();e(n).load(function(){s()})}else{t.container.find(".inner").addClass("html");t.container.find(".controls").hide();s()}t.overlay.click(function(){t.close()});t.container.find(".close").click(function(){t.close()});t.container.find("form").attr("action",r);i.resolve();t.debug("open popup")},close:function(){t.overlay.hide();t.container.find("* *").fadeOut(200,function(){t.container.hide();e(this).remove()});t.debug("close popup")},position:function(){t.container.setPosition=function(){if(t.settings.image){t.container.css({"max-height":e(window).height()-80,"max-width":e(window).width()-80});t.container.find("img.resp").css({"max-height":t.container.height(),"max-width":t.container.width()})}var n=e(window).width()-t.container.width(),r=e(window).height()-t.container.height();n=n/2+e(window).scrollLeft();r=r/2+e(window).scrollTop();t.container.css({top:Math.max(r,0),left:Math.max(n,0)})};e(window).bind("resize",function(e){t.container.setPosition()});t.container.setPosition();t.debug("position: true")},sliding:function(){t.data.each(function(t,n){e(n).attr("data-index",t)});t.data.click(function(){t.slidingAction(e(this));t.debug("sliding open");return false})},slidingBind:function(){if(!this.settings.prev||this.settings.prev.length===0)var n="";else n='<a href="'+this.settings.prev.attr("href")+'" class="prev" data-index="'+this.settings.prev.attr("data-index")+'"></a>';if(!this.settings.next||this.settings.next.length===0)var r="";else r='<a href="'+this.settings.next.attr("href")+'" class="next" data-index="'+this.settings.next.attr("data-index")+'"></a>';t.container.find(".controls").html(n+r);t.container.find(".controls a").unbind("click").bind("click",function(){t.slidingAction(e(this));return false});t.debug("slidingBind open")},slidingAction:function(n){this.settings.first=t.data.first().attr("data-index");this.settings.last=t.data.last().attr("data-index");this.settings.prev=e("[data-index="+(parseInt(n.attr("data-index"),10)-1)+"]");this.settings.next=e("[data-index="+(parseInt(n.attr("data-index"),10)+1)+"]");if(n.attr("data-index")==this.settings.first)this.settings.prev=false;if(n.attr("data-index")==this.settings.last)this.settings.next=false;t.settings.image=true;image=new Image;image.src=n.attr("href");e(image).attr("class","resp");t.open(image,n.attr("href"));t.debug("slidingAction open")},openLoader:function(){t.loader.show();t.debug("open Loader")},closeLoader:function(){t.loader.hide();t.debug("close Loader")},debug:function(e){if(t.settings.debug)console.log(e)}};e.fn.microPopup=function(n){if(t[n]){return t[n].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof n==="object"||!n){return t.init.apply(this,arguments)}else{e.error("Method "+n+" not found in jQuery.microPopup")}}})(jQuery)